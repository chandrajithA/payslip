<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="payslip.js" defer></script>
    <link rel="stylesheet" href="payslipstyle.css">
    <title>Document</title>
</head>
<body id="payroll-page">
    <div class="displaygrid">
        <nav class="navbarr">
            <div class="overview1 nav1">
                <img src="image/Overview.png" alt="" style="width: 18px;">
                <a href="overview.html">Overview</a>
            </div>
            <div class="payroll1 nav1" id="active">
                <img src="image/Payroll.png" alt="" >
                <a href="payroll.html" >Payroll</a>
            </div>
            <div class="payslip1 nav1">
                <img src="image/Payroll.png" alt="">
                <a href="payslip.html">Payslip</a>
            </div> 
            <div class="logoutarea1 nav1">
                <img src="image/logout.png" alt="" style="width: 18px;">
                <a href="login.html" onclick="logout()" id="logout-btn">Logout</a>
            </div>
        </nav>
        
        <main class="payroll-page-area pagemainarea" id="contentarea">
            
            <div class="payroll-header">
                <h1>Payroll Details</h1>
                <div>
                    <button class="download-button btnn" id="download-button">Download</button> 
                    <button onclick="window.print()" class="download-button btnn">Print</button>
                </div>
            </div>
            
            <div class="payroll-body">
                <form class="payrollform" id="payroll-form">
                    <div class="payroll-content">
                        <div>
                            <label for="empname">Employee Name</label><br>
                            <input type="text" name="empname" id="empname" required>
                        </div>
                        <div>
                            <label for="emproll">Employee roll</label><br>
                            <select name="emproll" id="emproll" required>
                                <option value="">Select any one</option>
                                <option value="Python Full Stack Developer">Python Full Stack Developer</option>
                                <option value="JavaFull Stack Developer">JavaFull Stack Developer</option>
                                <option value="JavaFull Stack Developer">UI / UX Designer</option>
                                <option value="JavaFull Stack Developer">Data Analyst</option>
                                <option value="Trainer">Trainer</option>
                                <option value="Team Lead">Team Lead</option>
                                <option value="Project Manager">Project Manager</option>
                                <option value="Manager">Manager</option>
                                <option value="Assistant Manager">Assistant Manager</option>
                                <option value="Administrator">Administrator</option>
                            </select>
                            
                        </div>
                        <div>
                            <label for="empid">Employee I'D</label><br>
                            <input type="text" name="empid" id="empid" required>
                        </div>
                        <div>
                            <label for="payrolldate">Date</label><br>
                            <input type="date" name="payrolldate" id="payrolldate" required>
                        </div>
                        <div>
                            <label for="monthselector">Payroll - Month & year</label><br>
                            <input type="month" name="monthselector" id="monthselector" required>
                        </div>
                        <div>
                            <label for="basicsalary">Basic Salary</label><br>
                            <input type="number" name="basicsalary" id="basicsalary" required>
                        </div>
                        <div>
                            <label for="workingdays">No of Working Days</label><br>
                            <input type="number" name="workingdays" id="workingdays" required readonly>
                        </div>
                        <div>
                            <label for="grosssalary">Gross Salary</label><br>
                            <input type="number" name="grosssalary" id="grosssalary" readonly required>
                        </div>
                        <div>
                            <label for="presentdays">Total Present Days</label><br>
                            <input type="number" name="presentdays" id="presentdays" required>
                        </div>
                        <div>
                            <label for="leavedays">Total Leave Days</label><br>
                            <input type="number" name="leavedays" id="leavedays" readonly required>
                        </div>
                        <div>
                            <label for="deductions">Deductions</label><br>
                            <input type="number" name="deductions" id="deductions" readonly required>
                        </div>
                        <div>
                            <label for="totalsalary">Total Salary</label><br>
                            <input type="number" name="totalsalary" id="totalsalary" readonly required>
                        </div> 
                        <div>
                            <label for="additions">Additions</label><br>
                            <input type="number" name="additions" id="additions" required>
                        </div>
                        <div>

                        </div> 
                        <div>
                            <label for="totalearning">Total Earnings</label><br>
                            <input type="number" name="totalearning" id="totalearning" readonly required>
                        </div>
                        
                    </div>
                    <div class="payroll-button">
                        <button type="submit" class="btnn" id="" style="background-color: #f8cc14; color: #455a64">Submit Payroll</button>
                        <button onclick="document.getElementById('payroll-form').reset()" class="btnn" id="" style="background-color: #455a64; color: white">Cancel</button>
                    </div>
                </form>
            </div>
        </main> 
    </div>


    <script>

        document.querySelector("form").addEventListener("submit", function(event) {
            event.preventDefault();
            localStorage.setItem('empname',empname.value);
            localStorage.setItem('emproll',emproll.value);
            localStorage.setItem('empid',empid.value);
            localStorage.setItem('payrolldate',payrolldate.value);
            localStorage.setItem('basicsalary',basicsalary.value);
            localStorage.setItem('totalsalary',totalsalary.value);
            localStorage.setItem('grosssalary',grosssalary.value);
            localStorage.setItem('workingdays',workingdays.value);
            localStorage.setItem('presentdays',presentdays.value);
            localStorage.setItem('leavedays',leavedays.value);
            localStorage.setItem('additions',additions.value);
            localStorage.setItem('deductions',deductions.value); 
            localStorage.setItem('monthselector',monthselector.value); 
            localStorage.setItem('totalearnings',totalearning.value); 
            alert("Payroll saved successfully");
            let response = confirm("To proceed payslip generation, click 'Ok', If you want to download this payroll details, click 'Cancel'");
            if(response){
                window.location.href = "payslip.html";
            }  
        } );


    document.getElementById("download-button").addEventListener("click", function () {
            const gridElement = document.getElementById("contentarea");
            const buttonsToHide = document.querySelectorAll(".btnn");
            const empnamee = localStorage.getItem("empname");
            const monthselectorr = localStorage.getItem("monthselector");

            buttonsToHide.forEach((btn) => btn.style.display = "none");
            

            html2canvas(gridElement, { scale: 2 }).then(canvas => {
            const imgData = canvas.toDataURL("image/png");
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();

            const imgWidth = 180; 
            const pageHeight = pdf.internal.pageSize.height;
            const imgHeight = canvas.height * imgWidth / canvas.width;

            pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
            
            buttonsToHide.forEach(btn => btn.style.display = "inline-block"); 
            pdf.save(empnamee+"_"+monthselectorr+"_payroll.pdf"); 

            });
    });

    </script>
</body>
</html>